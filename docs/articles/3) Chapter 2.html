<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="VCFtoGWAS">
<title>Chapter 2 - Run GWAS and Analyze • VCFtoGWAS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 2 - Run GWAS and Analyze">
<meta property="og:description" content="VCFtoGWAS">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">VCFtoGWAS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
 <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Manual</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/1)%20General.html">1) General</a>
    <a class="dropdown-item" href="../articles/2)%20Chapter%201.html">2) Chapter 1</a>
    <a class="dropdown-item" href="../articles/3)%20Chapter%202.html">3) Chapter 2</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Chapter 2 - Run GWAS and Analyze</h1>
            
      
      
      <div class="d-none name"><code>3) Chapter 2.Rmd</code></div>
    </div>

    
    
<!-- Website built with pkgdown::build_site()  -->
<blockquote>
<p>If you have access to the Rmarkdown files, you’ll find the files for this chapter <a href="https://weizmannacil-my.sharepoint.com/:f:/g/personal/tomer_antman_weizmann_ac_il/EguMukXHpppAg4O4d2aP0f8BOifz0nWod-xTC_-pqnz2EA?e=3jXJ8p" class="external-link">here</a></p>
</blockquote>
<p>In this chapter the GWAS is executed and the results are then analyzed. The package “<a href="https://github.com/Biometris/statgenGWAS/" class="external-link">statgenGWAS</a>” is the package that will mainly be used. To run the single-trait-GWAS, an object known as “gData” object needs to be provided.</p>
<div class="section level2">
<h2 id="step-2-1---create-gdata">Step 2.1 - Create gData<a class="anchor" aria-label="anchor" href="#step-2-1---create-gdata"></a>
</h2>
<p>In this step a “gData” object is created. It will contain all data needed for performing analyses, so the first thing to do when using the statgenGWAS package is to create it.</p>
<p>The gData object consists of a few components:</p>
<ol style="list-style-type: decimal">
<li>The Marker map (<code>map</code>) - is used to describe the physical positions of the markers on the chromosomes. The data consists of two columns, <code>chr</code> for the name or number of the chromosome and <code>pos</code> for the position of the marker on the chromosome.<br>
</li>
<li>The Marker matrix (<code>marker</code>) - contains the names of the markers in column names and the genotypes in the row names. Markers can either be coded as character strings or as numerical values.<br>
</li>
<li>Phenotypic data (<code>pheno</code>) - can either be a single data.frame or a list of data.frames for storing data for different trials or different summarizations of the original data. The first column of all elements of <code>pheno</code> should be genotype and all the other columns should represent different traits.</li>
</ol>
<p>Hence, we begin with collecting the “phenotypic” data.</p>
<p>The phenotypes need to be loaded into the functions as a data.frame of features in which:</p>
<ul>
<li><p>First column - contains all strain names. Name: “genotype”</p></li>
<li>
<p>Second column - contains the trial parameter (example: “Glucose” or “Glycerol”).</p>
<p>[if you don’t have any (only one condition), give the column a generic identical value for all rows]</p>
</li>
<li><p>Rest of the columns are the features and need to have clear names and numeric values.</p></li>
</ul>
<p>The gData also accepts covariates. Read more about the covariate option in the statgenGWAS package vignette. The covariate is entered to the function as a data.frame with strains as rownames. Make sure you notice all the parameters before running the <a href="(https://tomerantman.github.io/VCFtoGWAS/reference/create_gData.html)" class="external-link">create_gData</a> function (such as where the results will be saved)</p>
<p>Categorized features need to include the word “bin” in them (just because that’s how I wrote the code)</p>
<hr>
</div>
<div class="section level2">
<h2 id="step-2-2---single-trait-gwas">Step 2.2 - Single Trait GWAS<a class="anchor" aria-label="anchor" href="#step-2-2---single-trait-gwas"></a>
</h2>
<p>In this step, the “single trait GWAS” will be executed based on the gData object from the previous step.</p>
<p>If you wish to add randomization to your data (mix up the features) this is the step to do that.</p>
<div class="line-block">If you have access to the markdown files - In “Chunk 5: add randomization” you need to make sure “Randomize” parameter is TRUE and choose the number of randomizations (“randomizations” parameter).</div>
<p>Eventually, the <a href="https://www.rdocumentation.org/packages/statgenGWAS/versions/1.0.7/topics/runSingleTraitGwas" class="external-link">runSingleTraitGWAS</a> from “statgenGWAS” is used. If given only the gData, it executes the GWAS using bonferroni for multiple test correction (you can change it by changing the “thrType” parameter) and I advise to read the documentation of the function (click the link above).</p>
<p>This is also the step to separate your gData into training and testing strains if you wish to do so before running the GWAS.</p>
<p>The output here is a GWAS object, out of which we will mainly use “GWAResult” and “signSnp”.</p>
<p>Both are lists with the “results”/“significant snps” for each tested media (what is called “trial”)</p>
<div class="figure">
<img src="./step2.2Output.png" alt=""><p class="caption">GWAS result output</p>
</div>
<hr>
</div>
<div class="section level2">
<h2 id="step-2-3---conclusions">Step 2.3 - Conclusions<a class="anchor" aria-label="anchor" href="#step-2-3---conclusions"></a>
</h2>
<p>The idea of this step is get a grasp on your results:</p>
<div class="section level4">
<h4 id="qq">
<u>QQ:</u><a class="anchor" aria-label="anchor" href="#qq"></a>
</h4>
<p>Use a <a href="https://www.youtube.com/watch?v=okjYjClSjOg" class="external-link">Quantile-Quantile plot</a> to see if the p-values are uniformly distributed (up until some SNPs have a higher quantile than expected). Something like this is good (taken from actual results):</p>
<!-- ![](https://raw.githubusercontent.com/TomerAntman/VCFtoGWAS/main/man/figures/QQResults.png) -->
<p><img src="./QQresultsYfit.svg"></p>
<p>This can be achieved by using the “qqman” package with the “qq” function, or by using the plot function of the “statgenGWAS” package.</p>
</div>
<div class="section level4">
<h4 id="manhattan">
<u>Manhattan:</u><a class="anchor" aria-label="anchor" href="#manhattan"></a>
</h4>
<p>Next you use a Manhattan plot to show if SNPs were found significant above the p-value threshold (Bonferroni or FDR)</p>
<p>Either a simple version as can be created using the statgenGWAS package plot function: <code>plot(GWAS, trial="U",trait="fit")</code></p>
<p><img src="./ManhattanStatgen.png"></p>
<p>Or by calling the VCFtoGWAS <a href="https://tomerantman.github.io/VCFtoGWAS/reference/plot_manhattan.html" class="external-link">plot_manhattan</a> function, using ggplot and adding more info:</p>
<p><img src="./ManhatUfit_60.svg"></p>
</div>
<div class="section level4">
<h4 id="polygenic-effect-score">
<u>Polygenic Effect Score:</u><a class="anchor" aria-label="anchor" href="#polygenic-effect-score"></a>
</h4>
<p>Next, we compute the cumulative polygenic effect score of all the significant SNPs on the fitness. Explanation:</p>
<ul>
<li><p><strong>Ss</strong> = Score of a strain</p></li>
<li><p><strong>VA</strong> = variant (snp) appearance in that strain (0/1/2)</p></li>
<li><p><strong>VE</strong> = Variant effect (according to the GWAS), can be positive or negative.</p></li>
</ul>
<p>Ss(i) = [VA(1)xVE(1) + VA(2)xVE(2) +…+ VA(n)xVE(n) Or in other terms: <span class="math display">\[Ss_{i} = \sum_{i=1}^{n} VA_{i}\times VE_{i} \\\]</span></p>
<p>We may assume “Haploinsufficiency<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;In haploinsufficiency a single copy of the wild-type allele (A) at a locus in heterozygous combination with a variant allele (a) is insufficient to produce the wild-type phenotype. Meaning a/A isn’t as “good” as A/A.&lt;/p&gt;"><sup>1</sup></a>” for all the SNPs when calculating the score by choosing <code>haplo_sufficency = FALSE</code> in the function “<a href="https://tomerantman.github.io/VCFtoGWAS/reference/polygenic_effect_score.html" class="external-link">polygenic_effect_score</a>”</p>
<p>But if it is <code>TRUE</code> than “Haplo Sufficiency” is assumed and all the places of “1” (a/A) are changed to “0” (as if they are A/A) and all the places of “2” (a/a) are given a “1” instead.</p>
<p>Another parameter that will affect the plotted results is the <code>do_log2</code>. If true, instead of plotting the “Ss” on the X axis, the <span class="math inline">\(log_2[(-Ss)+1]\)</span> is plotted (in our case, we expect most if not all the SNPs are detrimental, so the scores will be either 0 or negative).</p>
<p>One other thing: notice that out of this function you get 2 outputs!</p>
<p>One of them is the plot itself and the second is a data frame with a column of the trait and a column of the score, this allows further analysis of the results if required (either in R or by exporting it to a csv)</p>
<p>Here are 2 examples of the plot output (one for a regular feature and the other for a categorized feature):</p>
<p><img src="./Ufit_polscore.png" alt="Regular Feature"><!--{width="50%"}--></p>
<p><img src="./Ubinfit_polscore.png" alt="Categorized Feature"><!--{width="50%"}--></p>
</div>
<div class="section level4">
<h4 id="trait-distribution-per-snp-alleles">
<u>Trait distribution per SNP alleles:</u><a class="anchor" aria-label="anchor" href="#trait-distribution-per-snp-alleles"></a>
</h4>
<p>To grasp the manner in which a trait distributes across all the SNPs, 3 distributions of the trait are drawn for each SNP:</p>
<p>1st for the strains that are homozygous for the major allele (don’t have the SNP), 2nd for heterozygous strains for the SNP, and 3rd for homozygous for the minor allele (have the SNP in both alleles).</p>
<p><img src="./Ufit_alleleVSfit.svg" alt="Regular Feature"> In the plot above, each box represents a SNP that was identified as significant. The X axis represents the trait (fitness in this case) and the y axis the density (frequency). The color represents the allele presence (0/0 is A/A, 0/1 is a/A, 1/1 is A/A). In each box, the number of times the “SNP presence” appears in the population is noted (top left). This plot gives a slight intuition regarding the effect of each SNP on its own (also regarding haplosufficiency)</p>
<p><img src="./Ubinfit_alleleVSfit.svg" alt="Categorized Feature"> In the plot above, each box represents a SNP that was identified as significant. The discrete X axis represents the categorized trait (binary fitness in this case) and the y axis the allele presence (0/0 is A/A, 0/1 is a/A, 1/1 is A/A). In bubble, the number of times that the “SNP presence” appears in the population, for the specific feature category, is noted (top left). This plot also gives a slight intuition regarding the effect of each SNP on its own (also regarding haplosufficiency)</p>
<p>these plots are created using the <a href="https://tomerantman.github.io/VCFtoGWAS/reference/allele_presence_plot.html" class="external-link">allele_presence_plot</a> function.</p>
<!-- ![Regular Feature](https://raw.githubusercontent.com/TomerAntman/VCFtoGWAS/main/man/figures/Ufit_alleleVSfit.png){width="50%"} -->
<!-- ![Categorized Feature](https://raw.githubusercontent.com/TomerAntman/VCFtoGWAS/main/man/figures/Ubinfit_alleleVSfit.png){width="50%"} -->
</div>
<div class="section level4">
<h4 id="exporting-the-results">
<u>Exporting the results:</u><a class="anchor" aria-label="anchor" href="#exporting-the-results"></a>
</h4>
<p>The markdown allows the creation of each plot on its own or creation of a PDF file with all of them for all the media and all the feature (including the randomized features) with exporting CSVs for each.</p>
<p>The plots will be vectors (high quality) and might be heavy. I recommend to open the PDF and print it as a PDF in a lower quality for faster skimming.</p>
<p>The exported CSV looks something like this (per media per feature):</p>
<table class="table table table-bordered table-hover table-condensed">
<thead><tr>
<th title="Field #1">snp</th>
<th title="Field #2">chr</th>
<th title="Field #3">pos</th>
<th title="Field #4">effect</th>
<th title="Field #5">allFreq</th>
<th title="Field #6">pValue</th>
<th title="Field #7">rom_chr</th>
<th title="Field #8">REF</th>
<th title="Field #9">ALT</th>
<th title="Field #10">gene</th>
<th title="Field #11">start</th>
<th title="Field #12">end</th>
<th title="Field #13">strand</th>
<th title="Field #14">description</th>
<th title="Field #15">ref_dna</th>
<th title="Field #16">alt_dna</th>
<th title="Field #17">ref_aa</th>
<th title="Field #18">alt_aa</th>
</tr></thead>
<tbody>
<tr>
<td>rs75889</td>
<td>4</td>
<td>432626</td>
<td>-1.917754411</td>
<td>0.055099648</td>
<td>3.84E-09</td>
<td>IV</td>
<td>G</td>
<td>A</td>
<td>YDL011C</td>
<td>432308</td>
<td>432631</td>
<td>-</td>
<td>Dubious open reading frame; unlikely to encode a functional protein, based on available experimental and comparative sequence data; overlaps the uncharacterized ORF YDL010W [Source:SGD;Acc:S000002169]</td>
<td>atggcc…</td>
<td>atggcc…</td>
<td>MAD...*</td>
<td>MAD…*</td>
</tr>
<tr>
<td>rs84422</td>
<td>4</td>
<td>657869</td>
<td>-1.726109591</td>
<td>0.069167644</td>
<td>2.13E-09</td>
<td>IV</td>
<td>G</td>
<td>A</td>
<td>YDR102C</td>
<td>657648</td>
<td>657980</td>
<td>-</td>
<td>Putative protein of unknown function; conserved among S. cerevisiae strains; YDR102C is not an essential gene; homozygous diploid deletion strain exhibits high budding index [Source:SGD;Acc:S000002509]</td>
<td>atgact…</td>
<td>atgact…</td>
<td>MTL...*</td>
<td>MTL...*</td>
</tr>
<tr>
<td>rs144135</td>
<td>6</td>
<td>89046</td>
<td>-1.15215202</td>
<td>0.106682298</td>
<td>4.93E-07</td>
<td>VI</td>
<td>T</td>
<td>G</td>
<td>YFL024C</td>
<td>87847</td>
<td>90345</td>
<td>-</td>
<td>Subunit of NuA4, an essential histone H4/H2A acetyltransferase complex; conserved region at N-terminus is essential for interaction with the NPC (nucleosome core particle); required for autophagy; homologous to Drosophila Enhancer of Polycomb; coding sequence contains length polymorphisms in different strains [Source:SGD;Acc:S000001870]</td>
<td>atgccg…</td>
<td>atgccg…</td>
<td>MPT...*</td>
<td>MPT...*</td>
</tr>
<tr>
<td>rs174979</td>
<td>7</td>
<td>531498</td>
<td>-1.967251191</td>
<td>0.032239156</td>
<td>3.33E-07</td>
<td>VII</td>
<td>G</td>
<td>A</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Files that contain info about the genes (that the significant SNPs might be in) are included in the package. The data is taken from the CDS file of Saccharomyces Cerevisiae.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tomer Antman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
