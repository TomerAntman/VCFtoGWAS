<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="VCFtoGWAS">
<title>Chapter 1 - VCF file to GWAS matrix • VCFtoGWAS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 1 - VCF file to GWAS matrix">
<meta property="og:description" content="VCFtoGWAS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">VCFtoGWAS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Chapter%201.html">Chapter 1 - VCF file to GWAS matrix</a>
    <a class="dropdown-item" href="../articles/General.html">General</a>
    <a class="dropdown-item" href="../articles/package_intro.html">package_intro</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 1 - VCF file to GWAS matrix</h1>
            
      
      
      <div class="d-none name"><code>Chapter 1.Rmd</code></div>
    </div>

    
    
<!-- Website built with pkgdown::build_site()  -->
<div class="section level2">
<h2 id="step-1-1---upload-vcf-to-r">Step 1.1 - Upload VCF to R<a class="anchor" aria-label="anchor" href="#step-1-1---upload-vcf-to-r"></a>
</h2>
<p>This step mainly uses the “<a href="https://tomerantman.github.io/VCFtoGWAS/reference/Upload_vcf_to_R.html" class="external-link">Upload_vcf_to_R</a>” function. Description can also be seen by running <code><a href="../reference/Upload_vcf_to_R.html">?Upload_vcf_to_R</a></code> in the console of Rstudio after loading the VCFtoGWAS package.</p>
<div class="section level4">
<h4 id="steps">Steps:<a class="anchor" aria-label="anchor" href="#steps"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>Load VCFtoGWAS library</p></li>
<li>
<p>Define parameters used for uploading and saving:</p>
<ul>
<li><p>VCF file path</p></li>
<li><p>Path where you wish to save your results</p></li>
<li><p>Whether you’d like to save and/or see the results</p></li>
</ul>
</li>
<li><p>Run Upload_vcf_to_R</p></li>
</ol>
<p>What is returned is a list containing a filtered fixed section and a gt section with only the genotypes (see <a href="https://tomerantman.github.io/VCFtoGWAS/articles/General.html#VCF-info" class="external-link">VCF info</a> in General Section) and also the path where the two were saved (they’ll be used in the next step)</p>
</div>
<div class="section level4">
<h4 id="output">Output:<a class="anchor" aria-label="anchor" href="#output"></a>
</h4>
<p>Notice that the “unwanted” column marks a strain that isn’t wanted (no pre-filtration was done). It can be omitted in the next step.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/TomerAntman/VCFtoGWAS/main/man/figures/step1.1Output.png" alt=""><p class="caption">step1.1_output</p>
</div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="step-1-2---filter">Step 1.2 - Filter<a class="anchor" aria-label="anchor" href="#step-1-2---filter"></a>
</h2>
<p>After extracting the fixed information and the gt section from the vcf file, it is time to filter the data.</p>
<p>First of all, if the uploaded vcf wasn’t pre-filtered to contain only the desired strains (by using the “usegalaxy” <a href="https://bit.ly/3oRbjx1" class="external-link">VCFselectsamples</a> tool), you can use this step to get only the strains that you wish to analyze. If an array of strain names isn’t provided, all the strains in the file will be used for further analysis.</p>
<p>After filtration, some rows (SNPs) might not contain any data at all (all NA). So the second thing that is done in this step is omitting those variants (SNPs).</p>
<p>Notice that you can choose whether or not to omit SNPs that are known to not appear in any of the remaining population. Meaning the information exists but they don’t appear in any strain. The reason to filter is that the amount of examined SNPs affects the p-values after correcting for multiple testing. The reason to not filter is that they are sort of a baseline and maybe shouldn’t be omitted. I decided to filter.</p>
<p>For example, for the 60 strains I worked on, the initial amount of variants is: 1,754,866</p>
<p>After filtering only by “all NA”, the amount was reduced to: 1,754,079 (meaning 787 were omitted)</p>
<p>But after filtering by “all [NA and/or 0/0]”, the amount was reduced to: 393,334 (meaning 1,361,532 were omitted). The latter was what I used in my tests.</p>
<p>The main function used in this step is the “<a href="https://tomerantman.github.io/VCFtoGWAS/reference/Filter_genotypes.html" class="external-link">Filter_genotypes</a>”.</p>
<p>The function returns a list of 3 objects: the fixed information (the left part of the output illustration), the filtered genotype matrix (the right part), and a string of the directory where the file are saved.</p>
<div class="section level4">
<h4 id="output-1">Output:<a class="anchor" aria-label="anchor" href="#output-1"></a>
</h4>
<p>Notice that the “unwanted” column was filtered out. Also the last row that contained all Na. If you chose to keep rows with SNPs that are 0/0 across all strains, the first row will not be omitted</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/TomerAntman/VCFtoGWAS/main/man/figures/step1.2Output.png" alt=""><p class="caption">step1.2_output</p>
</div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="step-1-3---expand">Step 1.3 - Expand<a class="anchor" aria-label="anchor" href="#step-1-3---expand"></a>
</h2>
<p>In this step, the fixed info (the left part of the output illustration) is expanded so that each row will represent only one SNP or INDEL and not multiple options per position. The genotype matrix is equally expanded.</p>
<p>In other words, the aim now is to make each row SNP-specific rather than location-specific. The number of variants (alterations) per chromosomal location is saved in an array named “indication”.</p>
<p>Before expanding, the fixed info looks like this:</p>
<blockquote>
<pre><code>        CHROM POS REF  ALT 
1 chromosome1  33  CA    C 
2 chromosome1 137   C  CCT 
3 chromosome1 176  CG C,AG 
4 chromosome1 184   C    G</code></pre>
</blockquote>
<p>Then after expanding:</p>
<blockquote>
<pre><code>          CHROM POS REF ALT 
1.0 chromosome1  33  CA   C 
2.0 chromosome1 137   C CCT 
3.0 chromosome1 176  CG   C 
3.1 chromosome1 176  CG  AG 
4.0 chromosome1 184   C   G</code></pre>
</blockquote>
<p>In this case, the indication array will be: <code> c(1, 1, 1, 2, 1) </code></p>
<p>As for the genotype matrix, we replicate rows similarly to how they were replicated in the fixed information:</p>
<p><u>Going from:</u></p>
<blockquote>
<pre><code>                CCG   BNT   BHF CEQ   CFR   BQQ   

chromosome1_33  NA    NA    NA  NA    NA    "0/0" 
chromosome1_137 NA    NA    NA  "0/0" NA    NA    
chromosome1_176 "0/1" "0/0" NA  "0/2" "0/0" NA    
chromosome1_184 "0/1" "0/0" NA  NA    "0/0" "0/0" </code></pre>
</blockquote>
<p><u>To:</u></p>
<blockquote>
<pre><code>                  CCG   BNT   BHF CEQ   CFR   BQQ   
chromosome1_33    NA    NA    NA  NA    NA    "0/0" 
chromosome1_137   NA    NA    NA  "0/0" NA    NA    
chromosome1_176   "0/1" "0/0" NA  "0/2" "0/0" NA    
chromosome1_176.1 "0/1" "0/0" NA  "0/2" "0/0" NA    
chromosome1_184   "0/1" "0/0" NA  NA    "0/0" "0/0" </code></pre>
</blockquote>
<p>The indication array will help us in the next step. You can see in the expanded example above that rows 3 and 4 are identical for the genotype matrix (chr1_176 and chr1_176.1) but are different for the fixed info (3.0 and 3.1).</p>
<p>So, when creating the GWAS matrix, we use the indication array to know which digit to look for. The 3rd index in the array is “1”, so in row number 3 in the genotype matrix, we count the number of instances of the number “1” for each strain (0/1 is 1 instance, 1/1 is 2 instances, 0/0 is 0 instances and so is 0/2). The 4th index in the array is “2”, so in row number 4 in the genotype matrix, we count the number of instances of the number “2” for each strain (0/2 is 1 instance…).</p>
<p>The main function used here is “<a href="https://tomerantman.github.io/VCFtoGWAS/reference/Expand_files.html" class="external-link">Expand_files</a>”</p>
<div class="section level4">
<h4 id="output-2">Output:<a class="anchor" aria-label="anchor" href="#output-2"></a>
</h4>
<p>Notice that now every row has one REF and one ALT.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/TomerAntman/VCFtoGWAS/main/man/figures/step1.3Output.png" alt=""><p class="caption">step1.3_output</p>
</div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="step-1-4---create-gwas-matrix">Step 1.4 - Create GWAS Matrix<a class="anchor" aria-label="anchor" href="#step-1-4---create-gwas-matrix"></a>
</h2>
<p>In this step, a GWAS matrix will be created and with this the first chapter of the process ends<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Unless a matrix of the offspring is desired. In that case, there is another step to be executed before moving on to the next chapter (Step 1.5)&lt;/p&gt;"><sup>1</sup></a>.</p>
<p>You can choose if you want the matrix to include only SNPs or SNPs and INDELs (default is both SNPs and INDELs) Also, after expanding in the previous step, some variants are now all 0/0 so we need to take those out now.</p>
<p>In this step, we go row by row, and by using the indication array from the previous step we determine the value given for each [i, j] element in the genotype matrix. The value can be 0, 1, 2 or NA. If we refer to the allele containing the SNP as the minor allele and we use the classic genetics nomenclature then a value of 0 is “A/A”, 1 is “a/A” and 2 is “a/a”. (a/a means a SNP appears in both alleles of strain)</p>
<p>The main function used in this step is “<a href="https://tomerantman.github.io/VCFtoGWAS/reference/Get_GWAS_matrix.html" class="external-link">Get_GWAS_matrix</a>”.</p>
<div class="section level4">
<h4 id="output-3">Output:<a class="anchor" aria-label="anchor" href="#output-3"></a>
</h4>
<p>The output consists of a matrix that can be used for the GWAS analysis and also the mapping information (what was the fixed info until now) which is also needed for the analysis.</p>
<p>Notice that until now the genotypes (strains) were column names but are now row names.</p>
<p><u>GWAS matrix:</u> <sub>(rs = reference SNP)</sub></p>
<div class="figure">
<img src="https://raw.githubusercontent.com/TomerAntman/VCFtoGWAS/main/man/figures/step1.4Output.png" alt=""><p class="caption">step1.4_output</p>
</div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="step-1-5---offspring-gwas-matrix">Step 1.5 - Offspring GWAS matrix<a class="anchor" aria-label="anchor" href="#step-1-5---offspring-gwas-matrix"></a>
</h2>
<p>Once a GWAS matrix for the parents was constructed, a matrix for the offspring can be constructed:</p>
<p>Let’s look at two possible parents and 6 snps (covering all the possibilities). The 3rd row shows the offspring of these parents and the value options for these snps for it. The 4th row shows the probability for each value option to happen (given the specific situation).</p>
<p>For example, for rs4 - both parents are 1 (“A/a”) and therefore the probability for the offspring to be 1 (“A/a”) is 0.5, to be 0 (“A/A”) is 0.25 and to be 2 (“a/a”) is 0.25.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="5%">
<col width="21%">
<col width="5%">
<col width="32%">
<col width="21%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>rs1</th>
<th>rs2</th>
<th>rs3</th>
<th>rs4</th>
<th>rs5</th>
<th>rs6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>BHF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>CEQ</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>BHFCEQ</td>
<td>0</td>
<td>0/1</td>
<td>1</td>
<td>0/1/2</td>
<td>1/2</td>
<td>2</td>
</tr>
<tr class="even">
<td><strong>Prob.</strong></td>
<td><strong>1</strong></td>
<td>
<span class="math inline">\(\frac{1}{2}\)</span><strong>/</strong><span class="math inline">\(\frac{1}{2}\)</span>
</td>
<td><strong>1</strong></td>
<td>
<span class="math inline">\(\frac{1}{4}\)</span><strong>/</strong><span class="math inline">\(\frac{1}{2}\)</span><strong>/</strong><span class="math inline">\(\frac{1}{4}\)</span>
</td>
<td>
<span class="math inline">\(\frac{1}{2}\)</span><strong>/</strong><span class="math inline">\(\frac{1}{2}\)</span>
</td>
<td><strong>1</strong></td>
</tr>
</tbody>
</table>
<p>In this manner the offspring GWAS matrix is built.</p>
<p>Note: If either parent has missing info for a SNP (NA), the offspring will also get NA</p>
</div>
<div class="section level2 tabset">
<h2 class="tabset" id="quarterly-results">Quarterly Results<a class="anchor" aria-label="anchor" href="#quarterly-results"></a>
</h2>


<ul class="nav nav-tabs" id="quarterly-results" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#by-product" id="by-product-tab" type="button" role="tab" aria-controls="by-product" aria-selected="true" class="active nav-link">By Product</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#by-region" id="by-region-tab" type="button" role="tab" aria-controls="by-region" aria-selected="false" class="nav-link">By Region</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="by-product" role="tabpanel" aria-labelledby="by-product-tab">

<p>(tab content)</p>
</div>
<div class="tab-pane" id="by-region" role="tabpanel" aria-labelledby="by-region-tab">

<p>(tab content)</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tomer Antman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
